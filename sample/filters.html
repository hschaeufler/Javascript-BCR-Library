<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8"/>
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <link rel="stylesheet" type="text/css" href="style/common-style.css">
    <link rel="stylesheet" type="text/css" href="style/index.css">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <title>Image filters</title>

</head>
<body class="body-index">

<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../src/bcr.js"></script>
<script type="text/javascript" src="js/index.js"></script>

<div id="header">Offline image filtering</div>
<input type="file" accept="image/*" id="inp"/>

<div id="form" class="section">
    <div class="title"><i class="fas fa-upload"></i> Submit a business card</div>
    <div class="center">
        <img src="https://via.placeholder.com/400x300/ddd?text=upload+a+business+card" id="step0"
             class="img-original" alt="Original image"/>
    </div>
</div>

<div class="center section"><img src="" id="step1" class="img-original" alt="step 1"/></div>
<div class="center section"><img src="" id="step2" class="img-original" alt="step 2"/></div>
<div class="center section"><img src="" id="step3" class="img-original" alt="step 3"/></div>

<script>

    $("#step0").on("click", function () {
        $("#inp").trigger("click");
    });

    document.getElementById('inp').onchange = function () {

        // step 0: Convert file to base64 image
        let file = this.files[0];
        file.convertToBase64(function (b64) {

            // bcr.recognizeBcr(b64, x => console.log("STEP0", x.result), function(){});
            document.getElementById('step0').src = b64;
            document.getElementById('step0').onload = function () {

                // step 1: Extract contours
                documentScanner(document.getElementById('step0'), function (b64) {

                    // bcr.recognizeBcr(b64, x => console.log("STEP1", x.result), function(){});
                    document.getElementById("step1").src = b64;
                    document.getElementById("step1").onload = function () {

                        // step 2: Apply filters
                        denoise(document.getElementById("step1"), function (b64) {

                            // bcr.recognizeBcr(b64, x => console.log("STEP2", x.result), function(){});
                            document.getElementById("step2").src = b64;
                            document.getElementById("step2").onload = function () {

                                // step 3: Apply business card cleaner pipeline
                                pipeline(b64, function () {
                                }, function (cleanedCanvas) {

                                    // bcr.recognizeBcr(cleanedCanvas.toDataURL(), x => console.log("STEP3", x.result), function(){});
                                    document.getElementById("step3").src = cleanedCanvas.toDataURL();

                                });
                            };
                        });
                    };
                });
            };
        });
    };
</script>
</body>
</html>
